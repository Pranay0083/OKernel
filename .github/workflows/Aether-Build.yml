name: Aether Build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-zig:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: goto-bus-stop/setup-zig@v2
        with:
          version: 0.15.2
      
      - name: Build
        working-directory: apps/aether/libaether
        run: zig build
      
      - name: Test
        working-directory: apps/aether/libaether
        run: zig build test

  build-swift:
    runs-on: macos-latest
    needs: build-zig
    steps:
      - uses: actions/checkout@v4
      - uses: goto-bus-stop/setup-zig@v2
        with:
          version: 0.15.2
      
      - name: Build Zig Library
        working-directory: apps/aether/libaether
        run: zig build -Doptimize=ReleaseFast
      
      - name: Build Swift App
        working-directory: apps/aether/AetherApp
        run: swift build
